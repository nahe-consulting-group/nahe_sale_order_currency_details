<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_saleorder_document_inherit" inherit_id="sale.report_saleorder_document">
        <xpath expr="//table[@class='table table-sm o_main_table']/tbody" position="inside">
            <t t-set="currency_rate" t-value="doc.pricelist_id.currency_id.with_context(date=doc.date_order).rate"/>
        </xpath>
        <xpath expr="//td[@name='td_priceunit']" position="inside">
            <span t-field="doc.pricelist_id.currency_id.symbol" />
        </xpath>
        <xpath expr="//td[@name='td_subtotal']" position="inside">
            <span t-field="doc.pricelist_id.currency_id.symbol" />
        </xpath>
        <xpath expr="//div[@name='so_total_summary']" position="after">
            <table class="table table-sm">
                <tr>
                    <td><strong>Tipo de cambio:</strong></td>
                    <td class="text-right">
                        <span t-esc="round(1 / doc.currency_rate, 2) if doc.currency_rate else 'N/A'"/>
                    </td>
                </tr>
                <tr>
                    <th>Subtotal en moneda de la compañía:</th>
                    <td class="text-right">
                        <span t-esc="doc.amount_untaxed / currency_rate" t-options="{'widget': 'monetary', 'display_currency': doc.company_id.currency_id}"/>
                    </td>
                </tr>
                <tr>
                    <th>Total en moneda de la compañía:</th>
                    <td class="text-right">
                        <span t-esc="doc.amount_total / currency_rate" t-options="{'widget': 'monetary', 'display_currency': doc.company_id.currency_id}"/>
                    </td>
                </tr>
            </table>
        </xpath>
    </template>
</odoo>

